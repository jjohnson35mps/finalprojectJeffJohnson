<!-- src/dashboard/templates/dashboard/detail.html -->
{% extends "core/base.html" %}
{% load humanize %}
{% block title %}{{ identity.address }} · Dark Web Leak Finder{% endblock %}

{% block content %}
<div class="card p-3 shadow-sm">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">{{ identity.address }}</h5>
    <div class="d-flex gap-2">
      <a class="btn btn-primary btn-sm" href="{% url 'breaches:scan' identity.pk %}">Scan Now</a>
      <a class="btn btn-outline-secondary btn-sm" href="/">Back</a>
    </div>
  </div>

  {% if hits %}
    <div class="accordion" id="breachAccordion">
      {% for h in hits %}
        <div class="accordion-item">
          <h2 class="accordion-header" id="head-{{ forloop.counter }}">
            <button class="accordion-button collapsed" type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#col-{{ forloop.counter }}">
              <strong class="me-2">{{ h.title|default:h.breach_name }}</strong>
              {% if h.domain %}<span class="text-muted">({{ h.domain }})</span>{% endif %}
            </button>
          </h2>
          <div id="col-{{ forloop.counter }}" class="accordion-collapse collapse"
               data-bs-parent="#breachAccordion">
            <div class="accordion-body">
              <!-- Removed the logo image block -->

              {% if h.occurred_on or h.added_on or h.modified_on %}
                <div class="mb-2 small text-muted">
                  {% if h.occurred_on %}Breach date: {{ h.occurred_on }} · {% endif %}
                  {% if h.added_on %}Added: {{ h.added_on }} · {% endif %}
                  {% if h.modified_on %}Modified: {{ h.modified_on }}{% endif %}
                </div>
              {% endif %}

              <div class="mb-2">
                {% if h.pwn_count %}<span class="badge text-bg-secondary me-1">PwnCount: {{ h.pwn_count|intcomma }}</span>{% endif %}
                {% if h.is_verified %}<span class="badge text-bg-success me-1">Verified</span>{% else %}<span class="badge text-bg-warning text-dark me-1">Unverified</span>{% endif %}
                {% if h.is_sensitive %}<span class="badge text-bg-danger me-1">Sensitive</span>{% endif %}
                {% if h.is_spam_list %}<span class="badge text-bg-secondary me-1">Spam List</span>{% endif %}
                {% if h.is_retired %}<span class="badge text-bg-dark me-1">Retired</span>{% endif %}
                {% if h.is_malware %}<span class="badge text-bg-danger me-1">Malware</span>{% endif %}
                {% if h.is_stealer_log %}<span class="badge text-bg-danger me-1">Stealer Log</span>{% endif %}
                {% if h.is_fabricated %}<span class="badge text-bg-secondary me-1">Fabricated</span>{% endif %}
                {% if h.is_subscription_free %}<span class="badge text-bg-info text-dark me-1">Free</span>{% endif %}
              </div>

              {% if h.data_classes %}
                <div class="mb-2">
                  <span class="badge text-bg-info text-dark">Data Classes</span>
                  <div class="mt-1">
                    {% for c in h.data_classes %}
                      <span class="badge text-bg-light border me-1 mb-1">{{ c }}</span>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

              {% if h.description %}
                <div class="text-body-secondary">{{ h.description|safe }}</div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-secondary mb-0">No known breaches stored.</div>
  {% endif %}
</div>
{% endblock %}
