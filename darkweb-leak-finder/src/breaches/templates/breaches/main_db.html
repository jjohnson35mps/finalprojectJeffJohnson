{% extends "core/base.html" %}
{% block content %}

<!-- flash messages -->
{% if messages %}
  <div class="mb-3">
    {% for m in messages %}
      <div class="alert alert-{{ m.tags|default:"secondary" }} mb-2">{{ m }}</div>
    {% endfor %}
  </div>
{% endif %}

<!-- Identities -->
<section id="identities" class="mb-4">
  <div class="card p-3 shadow-sm">
    <h2 class="h5 mb-3">Identities</h2>
    <form method="post" action="{% url 'breaches:add' %}" class="d-flex gap-2 mb-3">
      {% csrf_token %}
      <input name="email" type="email" class="form-control" placeholder="email@example.com" required>
      <button class="btn btn-primary">Add</button>
    </form>

    {% if identities %}
      <ul class="list-group list-group-flush">
        {% for i in identities %}
          <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center">
            <a href="#" class="text-decoration-none">{{ i.address }}</a>
            <a href="{% url 'breaches:scan' i.pk %}" class="btn btn-sm btn-outline-light">Scan</a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <span class="text-muted small">No identities yet. Add one above.</span>
    {% endif %}
  </div>
</section>

<!-- Scan (Shodan) -->
<section id="scan" class="mt-4">
  <div class="card p-3 shadow-sm">
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h2 class="h5 mb-0">Scan Target</h2>
      <small class="text-muted">Enter a domain or IP</small>
    </div>

    <form method="post" action="{% url 'breaches:scan_target' %}" class="d-flex gap-2">
      {% csrf_token %}
      <input name="target" type="text" class="form-control" placeholder="example.com or 1.2.3.4" required>
      <button class="btn btn-primary">Scan</button>
    </form>
  </div>

  {% if scans %}
    <div class="card p-3 shadow-sm mt-3">
      <h3 class="h6 mb-2">Recent scans</h3>
      <ul class="list-group list-group-flush">
        {% for s in scans %}
          <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center">
            <span>
              <strong>{{ s.ip }}</strong>
              {% if s.hostnames and s.hostnames|length %} â€” {{ s.hostnames|join:", " }}{% endif %}
              {% if s.org %}<span class="ms-2 small text-muted">{{ s.org }}</span>{% endif %}
              {% if s.os %}<span class="ms-2 small text-muted">OS: {{ s.os }}</span>{% endif %}
              {% if s.ports and s.ports|length %}
                <span class="ms-2 small text-muted">ports: {{ s.ports|join:", " }}</span>
              {% endif %}
            </span>
            <span class="small text-muted">{{ s.last_seen|date:"Y-m-d H:i" }}</span>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
</section>

{% endblock %}
