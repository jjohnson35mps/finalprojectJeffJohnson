{% extends "core/base.html" %}
{% load humanize breach_extras %}
{% block title %}Identity Â· {{ identity.address }}{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h5 mb-0">Breaches for {{ identity.address }}</h1>
  <div class="d-flex gap-2">
    <form method="post" action="{% url 'breaches:scan_identity' pk=identity.pk %}">{% csrf_token %}
      <button type="submit" class="btn btn-sm btn-primary">Rescan HIBP</button>
    </form>
    <a class="btn btn-sm btn-secondary" href="{% url 'breaches:dashboard' %}">Back</a>
  </div>
</div>

{% if hits %}
    <div class="list-group">
      {% for h in hits %}
        <div class="list-group-item bg-transparent border-secondary breach-card">
          <div class="d-flex justify-content-between align-items-start">
            <strong class="text-white">{{ h.title|default:h.breach_name|default:"(untitled breach)" }}</strong>
            <small class="muted">
              {% if h.occurred_on %}{{ h.occurred_on|date:"Y-m-d" }}{% else %}-{% endif %}
            </small>
          </div>

          {% if h.domain %}
            <div class="small muted">
              Domain:
              <a class="link" href="https://{{ h.domain }}" target="_blank" rel="noopener">{{ h.domain }}</a>
            </div>
          {% endif %}

          {% if h.pwn_count %}
            <div class="small muted">Pwned: {{ h.pwn_count|intcomma }}</div>
          {% endif %}

          {% with dc_list=h.data_classes %}
            {% if dc_list %}
              <div class="mt-2 d-flex flex-wrap gap-2">
                {% for dc in dc_list %}
                  <span class="btn btn-sm btn-ghost btn-chip" tabindex="-1" role="button" aria-disabled="true">{{ dc }}</span>
                {% endfor %}
              </div>
            {% endif %}
          {% endwith %}

          {% if h.description %}
            <div class="small mt-2 text-body-secondary">{{ h.description|safe }}</div>
          {% endif %}
        </div>
      {% empty %}
        <div class="alert alert-info">No breaches recorded for this identity yet.</div>
      {% endfor %}
    </div>
{% else %}
  <div class="alert alert-info">No breaches recorded for this identity yet.</div>
{% endif %}
{% endblock %}
